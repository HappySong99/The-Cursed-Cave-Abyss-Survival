<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Cursed Cave: Abyss Survival</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Noto+Sans+KR:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #000;
            color: #d1d5db;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .horror-font { font-family: 'Creepster', cursive; letter-spacing: 3px; }
        .rock-font { font-family: 'Metal Mania', cursive; letter-spacing: 2px; }

        /* 4:3 Aspect Ratio Container */
        #game-wrapper {
            width: 100%;
            height: 100%;
            max-width: 1024px;
            aspect-ratio: 4 / 3;
            position: relative;
            background: #000;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            overflow: hidden;
            border: 2px solid #1f2937;
        }

        @media (min-aspect-ratio: 4/3) { #game-wrapper { height: 90vh; width: auto; } }
        @media (max-aspect-ratio: 4/3) { #game-wrapper { width: 90vw; height: auto; } }

        /* Game Inner Container */
        #game-container {
            position: absolute; inset: 0;
            background: radial-gradient(circle at center, #1c1917 0%, #000000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* --- DOOR DESIGN (IMAGE BASED) --- */
        .door-panel {
            position: absolute; top: 0;
            width: 50.5%; height: 100%;
            background-color: #000;
            /* Door Image Mapping */
            background-image: url('./door.png'); 
            background-size: 200% 100%; /* Image is double the width of one panel */
            background-repeat: no-repeat;
            z-index: 40;
            transition: transform 1.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            border: none;
            display: flex; align-items: center; justify-content: center;
        }

        .door-left {
            left: 0;
            background-position: left center; /* Shows left half of image */
            border-right: 2px solid #000;
        }

        .door-right {
            right: 0;
            background-position: right center; /* Shows right half of image */
            border-left: 2px solid #000;
        }

        .door-open .door-left { transform: translateX(-100%); }
        .door-open .door-right { transform: translateX(100%); }

        /* --- MONSTER DESIGN --- */
        .monster-container {
            position: relative; cursor: pointer;
            transition: transform 0.3s;
            animation: float 3s ease-in-out infinite;
            display: flex; flex-direction: column; align-items: center;
            z-index: 20;
        }
        .monster-container:hover { transform: scale(1.05); }

        .monster-image {
            width: 280px; height: 280px;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(0,0,0,0.8));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes die {
            0% { transform: scale(1) rotate(0); opacity: 1; filter: grayscale(0); }
            100% { transform: scale(0) rotate(180deg); opacity: 0; filter: grayscale(1); }
        }
        .monster-die { animation: die 0.8s forwards !important; }

        /* Effects */
        #player-blood-overlay {
            position: absolute; inset: 0; pointer-events: none; z-index: 50;
            background: radial-gradient(circle, transparent 40%, rgba(180, 0, 0, 0.6) 90%);
            opacity: 0; transition: opacity 0.5s;
        }
        .blood-splatter { animation: bloodFlash 0.5s ease-out; }

        .monster-hit { animation: monsterHitAnim 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both; }
        @keyframes monsterHitAnim {
            0% { filter: brightness(1) sepia(0) saturate(1) hue-rotate(0deg); transform: translateX(0); }
            20% { filter: brightness(0.5) sepia(1) saturate(5) hue-rotate(-50deg); transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
            100% { filter: brightness(1); transform: translateX(0); }
        }
        @keyframes bloodFlash {
            0% { opacity: 0.8; background-color: rgba(255, 0, 0, 0.3); }
            100% { opacity: 0; }
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-4px, 0, 0); }
            20%, 80% { transform: translate3d(8px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-16px, 0, 0); }
            40%, 60% { transform: translate3d(16px, 0, 0); }
        }

        /* Full Screen Images (Start/End) */
        .screen-bg {
            position: absolute; inset: 0;
            background-size: cover; background-position: center; background-repeat: no-repeat;
            z-index: 60;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* UI */
        .stage-badge {
            background: rgba(0, 0, 0, 0.8); border: 2px solid #57534e;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.8); color: #d6d3d1;
        }
        .heart-icon { transition: all 0.3s; }
        .heart-lost { filter: grayscale(100%) brightness(0.2); transform: scale(0.8); }
        .modal-bg { background: rgba(28, 25, 23, 0.98); border: 2px solid #78716c; }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <!-- Blood Overlay -->
        <div id="player-blood-overlay"></div>

        <!-- Door Panels (Image Mapped) -->
        <div id="door-container">
            <div class="door-panel door-left"></div>
            <div class="door-panel door-right"></div>
        </div>

        <!-- Main Game Area -->
        <div id="game-container">
            <!-- Header -->
            <div class="absolute top-6 left-0 right-0 flex justify-between items-start px-8 z-30">
                <div>
                    <h1 class="text-3xl text-stone-300 rock-font drop-shadow-lg tracking-widest">THE CURSED CAVE</h1>
                    <p class="text-stone-500 text-xs mt-1 tracking-wider">Abyss Survival</p>
                </div>
                <div class="flex flex-col items-end gap-2">
                    <div class="flex gap-1" id="life-container">
                        <i data-lucide="heart" class="text-red-700 fill-red-700 heart-icon" size="24"></i>
                        <i data-lucide="heart" class="text-red-700 fill-red-700 heart-icon" size="24"></i>
                        <i data-lucide="heart" class="text-red-700 fill-red-700 heart-icon" size="24"></i>
                    </div>
                    <div class="stage-badge px-4 py-1 rounded text-lg font-bold rock-font">
                        DEPTH <span id="stage-number">1</span>
                    </div>
                </div>
            </div>

            <!-- Monster Scene -->
            <div id="monster-scene" class="flex flex-col items-center justify-center transition-all duration-500 mt-10">
                <div id="monster-visual" class="monster-container text-center" onclick="openPuzzle()">
                    <!-- Image injected by JS -->
                    <div id="monster-img-container" class="relative z-10"></div>
                    
                    <div class="mt-4">
                        <div class="bg-black/60 backdrop-blur-sm px-6 py-2 rounded border border-stone-600 shadow-xl">
                            <span id="monster-name" class="text-2xl text-stone-300 font-bold tracking-widest uppercase rock-font">Monster</span>
                        </div>
                        <p class="text-gray-500 text-xs mt-2 animate-pulse uppercase tracking-wider">Click to Attack</p>
                    </div>
                </div>
            </div>
            
            <!-- Floor Gradient -->
            <div class="absolute bottom-0 w-full h-1/3 bg-gradient-to-t from-black via-stone-900/20 to-transparent pointer-events-none z-10"></div>
        </div>
    </div>

    <!-- Start Screen (Image Based) -->
    <div id="start-screen" class="screen-bg" style="background-image: url('./start.png');">
        <!-- Overlay for readability if needed, or rely on the image -->
        <div class="bg-black/60 p-8 rounded-lg text-center backdrop-blur-sm border border-stone-600 mt-40">
            <h1 class="text-5xl text-stone-200 mb-4 rock-font animate-pulse tracking-widest">ENTER THE ABYSS</h1>
            <p class="text-gray-300 mb-6 font-sans">
                목숨은 3개. 문제를 풀어 탈출하세요.
            </p>
            <button onclick="startGame()" class="px-12 py-3 bg-red-900/80 hover:bg-red-800 text-white font-bold rounded border-2 border-red-700 text-2xl tracking-widest transition-all hover:scale-105 shadow-lg rock-font">
                ENTER
            </button>
        </div>
    </div>

    <!-- Win Screen (Image Based) -->
    <div id="win-screen" class="screen-bg hidden" style="background-image: url('./end.png');">
        <div class="bg-black/70 p-10 rounded-lg text-center backdrop-blur-sm border border-yellow-600 mt-40">
            <h2 class="text-6xl text-yellow-500 mb-4 rock-font">SURVIVED</h2>
            <p class="text-xl text-gray-200 mb-8">탈출에 성공했습니다!</p>
            <button onclick="location.reload()" class="px-8 py-3 bg-white text-black font-bold rounded hover:bg-gray-300 transition">
                PLAY AGAIN
            </button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center text-center hidden">
        <i data-lucide="skull" class="text-stone-600 mb-6" size="80"></i>
        <h2 class="text-6xl text-red-800 mb-4 rock-font">LOST IN DARKNESS</h2>
        <button onclick="location.reload()" class="px-8 py-3 bg-stone-200 text-black font-bold rounded hover:bg-stone-400 transition mt-8">
            TRY AGAIN
        </button>
    </div>

    <!-- Puzzle Modal -->
    <div id="puzzle-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden backdrop-blur-sm p-4">
        <div class="modal-bg w-full max-w-lg p-6 rounded-lg shadow-2xl relative transform transition-all scale-100 flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-4 border-b border-stone-600 pb-3">
                <h3 id="puzzle-title" class="text-xl font-bold text-stone-300 rock-font tracking-wider">CHALLENGE</h3>
            </div>
            <div id="puzzle-body" class="mb-4 text-center text-lg text-gray-200 leading-relaxed font-sans"></div>
            <div id="puzzle-options" class="grid gap-3 overflow-y-auto mb-4"></div>
            <div id="feedback-area" class="mt-auto hidden p-4 rounded text-center border bg-stone-900 border-stone-600">
                <div id="feedback-message" class="font-bold text-lg mb-2"></div>
                <div id="feedback-explanation" class="text-sm text-gray-300 mb-4 text-left leading-relaxed"></div>
                <button id="feedback-btn" class="w-full bg-stone-700 hover:bg-stone-600 text-white font-bold py-2 rounded transition">확인 (NEXT)</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let currentStage = 0;
        const totalStages = 5;
        let lives = 3;
        let pendingAction = null;

        // Configuration with Image Paths
        // NOTE: Please ensure these files exist in the same directory:
        // slime.png, zombie.png, vampire.png, ghost.png, the_reaper.png
        const stageConfig = [
            { name: "Slime", image: "./slime.png", type: "vocab" },
            { name: "Zombie", image: "./zombie.png", type: "grammar" },
            { name: "Vampire", image: "./vampire.png", type: "structure" },
            { name: "Ghost", image: "./ghost.png", type: "reading" },
            { name: "The Reaper", image: "./the_reaper.png", type: "logic" }
        ];

        // Questions (Grade 6)
        const questionPools = {
            vocab: [
                {
                    q: "다음 설명에 맞는 장소는?<br><br><em class='text-yellow-400'>'You can borrow books here.'</em>",
                    options: [{text: "Hospital", correct: false}, {text: "Library", correct: true}, {text: "Bakery", correct: false}, {text: "Police Station", correct: false}],
                    explanation: "<strong>정답: Library</strong><br>책을 빌리는 곳은 도서관입니다."
                },
                {
                    q: "빈칸에 알맞은 단어는?<br><br><span class='text-yellow-400'>'I am hungry. Let's eat ______.'</span>",
                    options: [{text: "water", correct: false}, {text: "pencil", correct: false}, {text: "pizza", correct: true}, {text: "soccer", correct: false}],
                    explanation: "<strong>정답: pizza</strong><br>배가 고플 때 먹는 것은 음식인 피자입니다."
                }
            ],
            grammar: [
                {
                    q: "과거형 문장은?<br><br><span class='text-yellow-400'>'She ______ to the park yesterday.'</span>",
                    options: [{text: "go", correct: false}, {text: "goes", correct: false}, {text: "went", correct: true}, {text: "going", correct: false}],
                    explanation: "<strong>정답: went</strong><br>Yesterday(어제)가 있으므로 go의 과거형 went를 씁니다."
                },
                {
                    q: "전치사 찾기:<br><br><span class='text-yellow-400'>'The cup is ______ the table.' (위에)</span>",
                    options: [{text: "in", correct: false}, {text: "on", correct: true}, {text: "under", correct: false}, {text: "at", correct: false}],
                    explanation: "<strong>정답: on</strong><br>표면 위에 있을 때는 on을 사용합니다."
                }
            ],
            structure: [
                {
                    q: "문장 순서 맞추기:<br><br><span class='text-yellow-400'>[ like / I / soccer / playing ]</span>",
                    options: [{text: "I like playing soccer.", correct: true}, {text: "I soccer playing like.", correct: false}, {text: "Playing like I soccer.", correct: false}, {text: "Like I soccer playing.", correct: false}],
                    explanation: "<strong>정답: I like playing soccer.</strong><br>주어(I) + 동사(like) + 목적어(playing soccer) 순서입니다."
                }
            ],
            reading: [
                {
                    q: "어떤 계절인가요?<br><br><em class='text-gray-400'>'It is cold. White snow falls.'</em>",
                    options: [{text: "Summer", correct: false}, {text: "Winter", correct: true}, {text: "Spring", correct: false}, {text: "Fall", correct: false}],
                    explanation: "<strong>정답: Winter</strong><br>춥고 눈이 오는 계절은 겨울입니다."
                }
            ],
            logic: [
                {
                    q: "성격이 다른 단어는?",
                    options: [{text: "Apple", correct: false}, {text: "Banana", correct: false}, {text: "Car", correct: true}, {text: "Grape", correct: false}],
                    explanation: "<strong>정답: Car</strong><br>나머지는 과일이지만 Car는 탈것입니다."
                }
            ]
        };

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('door-container').classList.add('door-open');
                renderStage();
            }, 500);
        }

        function renderStage() {
            const config = stageConfig[currentStage];
            const imgContainer = document.getElementById('monster-img-container');
            
            // Image Injection
            imgContainer.innerHTML = `<img src="${config.image}" class="monster-image" alt="${config.name}">`;
            
            // Update Text
            document.getElementById('stage-number').innerText = currentStage + 1;
            document.getElementById('monster-name').innerText = config.name;
            
            // Reset Animation
            const monsterVisual = document.getElementById('monster-visual');
            monsterVisual.classList.remove('monster-die');
            monsterVisual.style.opacity = '1';
        }

        function openPuzzle() {
            if (lives <= 0) return;
            const config = stageConfig[currentStage];
            // Fallback to vocab if pool empty/missing
            const pool = questionPools[config.type] || questionPools['vocab']; 
            const puzzleData = pool[Math.floor(Math.random() * pool.length)];
            
            const modal = document.getElementById('puzzle-modal');
            const body = document.getElementById('puzzle-body');
            const optionsDiv = document.getElementById('puzzle-options');
            const feedback = document.getElementById('feedback-area');

            body.innerHTML = puzzleData.q;
            optionsDiv.innerHTML = '';
            feedback.classList.add('hidden');
            feedback.dataset.explanation = puzzleData.explanation;

            puzzleData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left bg-stone-800 hover:bg-stone-700 p-3 rounded text-stone-200 transition border border-stone-600 text-base flex items-center gap-3 group font-sans";
                btn.innerHTML = `<span class="w-6 h-6 rounded-full border border-stone-500 flex items-center justify-center text-xs text-stone-400 group-hover:border-red-500 group-hover:text-red-500 transition">${index + 1}</span> ${opt.text}`;
                btn.onclick = () => handleOptionClick(opt.correct, btn);
                optionsDiv.appendChild(btn);
            });
            modal.classList.remove('hidden');
        }

        function handleOptionClick(isCorrect, btnElement) {
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackMsg = document.getElementById('feedback-message');
            const feedbackExp = document.getElementById('feedback-explanation');
            const feedbackBtn = document.getElementById('feedback-btn');
            const buttons = document.querySelectorAll('#puzzle-options button');

            buttons.forEach(b => b.disabled = true);
            feedbackArea.classList.remove('hidden');
            feedbackExp.innerHTML = feedbackArea.dataset.explanation;

            if (isCorrect) {
                btnElement.classList.replace('bg-stone-800', 'bg-green-900');
                btnElement.classList.replace('border-stone-600', 'border-green-500');
                feedbackArea.className = "mt-auto p-4 rounded text-center border bg-green-950/90 border-green-600";
                feedbackMsg.innerHTML = "<span class='text-green-400'>정답! (Hit)</span>";
                
                triggerMonsterDamage();
                pendingAction = () => {
                    closeModal();
                    triggerStageTransition();
                };
            } else {
                btnElement.classList.replace('bg-stone-800', 'bg-red-900');
                btnElement.classList.replace('border-stone-600', 'border-red-500');
                lives--;
                updateLifeDisplay();
                triggerPlayerDamage();
                
                feedbackArea.className = "mt-auto p-4 rounded text-center border bg-red-950/90 border-red-600";
                
                if (lives <= 0) {
                    feedbackMsg.innerHTML = "<span class='text-red-500'>오답! (Game Over)</span>";
                    pendingAction = () => {
                        closeModal();
                        document.getElementById('game-over-screen').classList.remove('hidden');
                    };
                } else {
                    feedbackMsg.innerHTML = `<span class='text-red-400'>오답! (Lives: ${lives})</span>`;
                    pendingAction = () => closeModal();
                }
            }
            feedbackBtn.onclick = () => { if (pendingAction) pendingAction(); };
        }

        function triggerMonsterDamage() {
            const monsterImg = document.getElementById('monster-img-container');
            monsterImg.classList.add('monster-hit');
            setTimeout(() => monsterImg.classList.remove('monster-hit'), 500);
        }

        function triggerPlayerDamage() {
            const overlay = document.getElementById('player-blood-overlay');
            overlay.classList.add('blood-splatter');
            overlay.style.opacity = '1';
            setTimeout(() => {
                overlay.classList.remove('blood-splatter');
                overlay.style.opacity = '0';
            }, 500);
            document.getElementById('game-wrapper').classList.add('shake');
            setTimeout(() => document.getElementById('game-wrapper').classList.remove('shake'), 500);
        }

        function updateLifeDisplay() {
            const hearts = document.querySelectorAll('.heart-icon');
            if (hearts[lives]) hearts[lives].classList.add('heart-lost');
        }

        function triggerStageTransition() {
            const monster = document.getElementById('monster-visual');
            monster.classList.add('monster-die');
            setTimeout(() => {
                document.getElementById('door-container').classList.remove('door-open');
                setTimeout(() => {
                    currentStage++;
                    if (currentStage >= totalStages) {
                        document.getElementById('win-screen').classList.remove('hidden');
                    } else {
                        renderStage();
                        document.getElementById('door-container').classList.add('door-open');
                    }
                }, 1500);
            }, 800);
        }

        function closeModal() {
            document.getElementById('puzzle-modal').classList.add('hidden');
            document.getElementById('feedback-area').classList.add('hidden');
        }
    </script>
</body>
</html>